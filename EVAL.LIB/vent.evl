; Управление вентиляцией при загазованности и пожаре в блоке
; 

; входные переменные:
; сигнал на управление венитиляцией
; zag - 1 - загазованность
; pps - 1 - сигнал пожара
; t - время работы вентиляции после пропад сигн загазованности

; возврат:
; 0 - действий не требуется
; 1 - требуется включить вентиляцию
; 2 - требуется отключить вентиляцию

func ventSig(zag,pps,t,id) 
  x=0  
  ; появилась загазованность 
  if (zag & !dout[id]) 
    x=1 ; включить 
    aout[id+1]=0
  endif 
  ;
  ; пропала загазованоость 
  if (!zag & dout[id]) 
    aout[id+1]=getticks(0) ; считать время 
  endif 
  dout[id]=zag 
  ;
  ; время истекло 
  if ne(aout[id+1],0) & gt(getticks(aout[id+1])*ticksize(),t) 
    x=2 ; выключить 
    aout[id+1]=0
  endif 
  ;
  ; при пожаре 
  if pps 
    x = 2  ;блокировка пуска 
  endif 
  ;
  return(x) 
endfunc


; ------- Пример использования ПУСК, СТОП - отдельные реле ---------
;sig=ventSig({1СН4 ПОР1 КУШН},eq({ЯХПЖ ШС3 КУШН},2),60,20)
;set {ВЕНТ ВКЛ КУШН}[sys_num], eq(sig,1) ; КН.ПУСК
;set {ВЕНТ ОТКЛ КУШН}[sys_num],eq(sig,2) ; КН.СТОП
;
; -------- Пример использования ПУСК, СТОП - одно реле  -------------
;sig=ventSig({1СН4 ПОР1 КУШН},eq({ЯХПЖ ШС3 КУШН},2),60,20)
;if  ne(sig,0)
;  set {ВЕНТ УПР КУШН}[sys_num],eq(sig,1) ; 
;endif
;------------------------


