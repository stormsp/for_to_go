; ЭРА-10-8v-v4(09.12.2015)
; Галеев 04.17

func tehparam(ba,cod)
 dout[ba+0]=bit(cod,0) + 2 * bit(cod,2)
 	;0 выходное звено в положении "Открыто"
 	;1 выходное звено в положении "Закрыто"
 dout[ba+1]=bit(cod,2) | bit(cod,3)
 	;2 моментная муфта при открытии сработала (Df10)
 	;3 моментная муфта при уплотнении сработала (Df20)
 	;4 (резерв)
 dout[ba+2]=bit(cod ,5)
 	;5 разряд элемента питания
 	;6 (резерв)
 dout[ba+3]=bit(cod ,7)
 	;7 1-включено состояние "ДУ",0-включено состояние "МУ"
 dout[ba+4]=bit(cod,8) + 2 * bit(cod,9)
	;8 выполняется операция "Открытие"
	;9 выполняется операция "Закрытие"
	;10 выполняется операция "Стоп" (привод остановлен)
	;11 cбой ДП (Df24)
	;12 работа по аналоговому входу
 dout[ba+5]=bit(cod,13)
	;13 включен нагрев
 dout[ba+6]=bit(cod,14)
	;14 выход задания по аналоговому входу за пределы диапазона (4-20) мА (Df21)
 dout[ba+7]=bit(cod,15)
	;15 готов к технологическим операциям (устанавливается в "0" после срабатывания защит)
endfunc

func def_8v(ba,cod1,cod2)
  dout[ba+0]=bit(cod1,1)|bit(cod1,2)|bit(cod1,3)|bit(cod1,4)|bit(cod1,5)|bit(cod1,6)|bit(cod1,7)
  	;cod1:
  	;0 резерв
	;1 Df2: сработала защита по превышению тока в цепи фаз электродвигателя
	;2 Df8: Времятоковая защита
 	;3 Df6: Сопротивления изоляции обмоток статора электродвигателя меньше 0,5 МОм
 	;4 Df12: Обрыв фазы электродвигателя
 	;5 Df23: Сопротивление изоляции обмоток статора электродвигателя меньше 1,0 МОм
	;6 Df19: Перегрев электродвигателя
	;7 Df5: Двигатель не подключен
  
  dout[ba+1]=bit(cod1,8)|bit(cod1,14)|bit(cod1,15)
  	;8 Df13: Сбой памяти параметров пользователя
 	;14 Df15: Сбой памяти заводских параметров
	;15 Df16: Сбой памяти данных калибровки положения
  dout[ba+2]=bit(cod1,9)|bit(cod1,10)|bit(cod1,13)
	;9 Df22: Нет служебной фазы
	;10 Df7: Низкое напряжение в сети
	;13 Df11: Напряжение в сети на 31 % больше номинального
  dout[ba+3]=bit(cod1,11) + 2 * bit(cod1,12)
	;11 Df3: Перегрев СМ(силовой модуль)
	;12 Df4: Переохлаждение СМ(силовой модуль)
	
;------------------ cod2: --------------------
 	;Второй регистр дефектов
	;1;(резерв)
   dout[ba+4]=bit(cod2,2) + 2 * bit(cod2,3)
	;2; 1 - (Df27): Перегрев МПР(модуль процессора)
	;3; 1 - (Df28): Переохлаждение МПР(модуль процессора)
 	;4; (резерв)
	;5;1 - (Df36): Отключено зарядное реле
   dout[ba+5]=bit(cod2,0)|bit(cod2,5)|bit(cod2,6)|bit(cod2,7)|bit(cod2,8)|bit(cod2,9)|bit(cod2,10)
	;0;1 - (Df14): Напряжение на шине постоянного тока СМ(силовой модуль) на 50 % больше номинального
	;6;1 - (Df1): Напряжение на шине постоянного тока СМ(силовой модуль) на 55% меньше номинального
	;7;1 - (Df33): Напряжение в сети на 47 % больше номинального
	;8;1 - (Df34): Импульсное напряжение в сети на 31 % больше номинального
	;9;1 - (Df35): Импульсное напряжение в сети на 47 % больше номинального
	;10;1 - (Df38): Длительное перенапряжение (от 10 мс) на шине постоянного тока СМ
	;11-15;(резерв)
 	
  return(0)
endfunc


func sbros(ba,cnt_sys)
  if ne(dost(dout[ba]),1)
    dout[ba]=0
  endif
  if (dout[ba])
    dout[ba]=0
    set cnt_sys,16
  endif
  
endfunc










