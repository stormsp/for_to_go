; БУПГ24-3, БУПГ24-6
; Галеев 08.2019

;----------- <Адрес 11>. Состояние дискретных датчиков -------------------
;Единицы в битах регистра (кроме бита 10) означают, что соответствующие датчики  находятся в состоянии "Авария"
; нули - что соответствующие датчики находятся в состоянии "Норма". 
; 
; Соответствие битов регистра входным сигналам:
;   0 - неисправность датч Твх - БУПГ24-6
;   1 - не используются; 
;   2 - сигнал перегрева; 
;   3 - сигнал <Давление газа высокое>; 
;   4 - сигнал <Давление газа низкое>; 
;   5 - сигнал <Давление продукта высокое>;   
;   6 - сигнал <Давление продукта низкое>; 
;   7 - сигнал <Разрежение низкое>; 
;   8 - сигнал <Уровень теплоносителя низкий>; 
;   9 - сигнал <Прорыв газа>; 
;   10 - сигнал <>; 1 - наличие пламени, 0 - его отсутствие. 
;   11 - сигнал <Расход продукта низкий>; 
;   12 - сигнал <Давление запальника высокое>; 
;   13 - сигнал <Загазованность>; 
;   14 - сигнал <Неисправность аналогового датчика  температуры теплоносителя>; 
;   15 - сигнал <Неисправность аналогового датчика температуры газа на выходе>.
;-----------------------------
;--------<Адрес 12>. Аварийные состояния датчиков 
;Соответствие битов регистра входным сигналам: аналогично регистрам 1, 11. 
;При аварийном отключении подогревателя по какому-либо сигналу бит, 
;соответствующий этому сигналу, устанавливается в 1. 
;Содержимое регистра сохраняется до следующего аварийного отключения подогревателя или отключения питания БУПГ.

func bupg243(bp,cod)
  dout[bp+0]=ne(cod & 4, 0) 	;Перегрев
  dout[bp+1]=ne(cod & 8, 0) 	;Ргаза высокое
  dout[bp+2]=ne(cod & 16, 0) 	;Ргаза низкое
  dout[bp+3]=ne(cod & 32, 0) 	;Ртн высокое
  dout[bp+4]=ne(cod & 64, 0) 	;Ртн низкое
  dout[bp+5]=ne(cod & 128, 0) 	;Разряжение низкое
  cod=int(cod/256)
  dout[bp+6]=ne(cod & 1, 0)	;Уровень тн низкий
  dout[bp+7]=ne(cod & 2, 0)	;Прорыв газа
  dout[bp+8]=ne(cod & 4, 0)	;Пламя 0-нет 1-есть
  dout[bp+9]=ne(cod & 8, 0)	;Расход низкий
  dout[bp+10]=ne(cod & 16, 0)	;Давление запальника высокое
  dout[bp+11]=ne(cod & 32, 0)	;Загазованность
  dout[bp+12]=ne(cod & 64, 0)	;(3Э,3М.1,.2 не использ) Пламя отсутств(3М), Неиспр датч температуры тн
  dout[bp+13]=ne(cod & 128, 0) 	;(3Э,3М.1,.2 не использ) Неиспр датч температуры(3М) вых газа
  return(0)                                       
endfunc

func bupg243_klap(bp,cod)
  dout[bp+0]=ne(cod & 2, 0) 	; клапан запальника
  dout[bp+1]=ne(cod & 4, 0)	; клапан отсекателя
  dout[bp+2]=ne(cod & 8, 0)	; клапан б.горения
  dout[bp+3]=ne(cod & 16, 0)	; сигнал аварии
  dout[bp+4]=ne(cod & 32, 0)	; звук сигнала аварии
  dout[bp+5]=ne(cod & 64, 0)	; клапан безопасности
  return(0)                                       
endfunc

; Функция отображения причины останова подогревателя 
; В режиме "Авария" расшифровывается регистр 12. В остальных режимах регистр 11

func bupg(bp, mode, cod11, cod12)
  if eq(mode,6) ; Авария
    x=bupg243(bp,cod12)
  else
    x=bupg243(bp,cod11)
  endif
  return(0)
endfunc








