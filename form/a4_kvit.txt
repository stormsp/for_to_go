; ГРС Красноусольский
; квитирование
; период выполнения 4 тика

#include "eval.lib\kvit.evl"
#include "eval.lib\set.evl"

func oninit(t)
 ; ждем первого опроса модулей
 sleep(6*18)
 dout[1]={КН КВИТ КРАС}
 dout[2]={КВИТ БУС1}
 dout[3]={КВИТ БУС2}
 dout[4]={КВИТ АРМ КРАС}
 dout[5]={КВИТ ПУДП КРАС}
 dout[6]=0
 dout[7]=0

 prevpos={КАЛИТ ГРС КРАС}
endfunc


; основной цикл
;
; переменные:
; 1-5 - для работы kvitKP
; 6 - тело для {КВИТ АРМ КРАС}
; 7 - тело для {КВИТ ПУДП КРАС}
;

; неквитированность в КП в его внешний звук
a=setex ({АВАР.СИГ КРАС}[sys_num],{НЕКВИТ КП КРАС}|{УСТ АРМ КРАС})

; квитирование возможно из источников (БУСы, панельник, ПУ)
x=kvitKP({КН КВИТ КРАС}[sys_num],1)
x=kvitKP({КВИТ БУС1}[sys_num],2)
x=kvitKP({КВИТ БУС2}[sys_num],3)
x=kvitKP({КВИТ АРМ КРАС}[sys_num],4)
x=kvitKP({КВИТ ПУДП КРАС}[sys_num],5)


kalit={КАЛИТ ГРС КРАС}
if(ne(kalit,prevpos)&eq(kalit,0))
 SET_STAT {КАЛИТ ГРС КРАС}[SYS_NUM],CURRENT_KVIT,1
endif
prevpos=kalit
