; ГРС Красноусольский
; Галеев 07.2019
; занесение в эр04 индекса датчика для регулир
; копирование заданий эр04 набора 1 в наборы 2,3

 #include "eval.lib\set.evl"

FUNC ONINIT(T) 
  dout[1]=0
  SLEEP(40)  		; ждем первого опроса модулей
ENDFUNC 

func fnCheckP(pz,p1,p2,p3)
  x=0
  x=x+gt(abs(pz-p1),0.001)
  x=x+gt(abs(pz-p2),0.001)
  x=x+gt(abs(pz-p3),0.001)
  return(gt(x,0))
endfunc


; здесь расчетное значение заносится в эр04, меняя набор
; требуется период алгоблока 5 сек
; работает всегда независ от работы рег с 03.2012
;
 
  a=setwex({ДАТ РЕГ04 КРАС}[sys_num],{ТЕКДАТЧРЕГ КРА},5)

; при массовом пр-ве отн Поляны добавка - из уст извне в набор 1
; т.к. пс вырабатывается отн уст извне 2012
;


if fnCheckP({РВЫХ ЗАД КРАС},{ЗАД РРЕГ КРАС},{РРЕГ НАБОР2},{РРЕГ НАБОР3})
  if(eq({РЕЖ РЕГ04 КРАС},1))
    if(eq(setwex({РЕЖ РЕГ04 КРАС}[sys_num],0,10),0))
      dout[1]=1
      x=setex({ЗАД РРЕГ КРАС}[sys_num],{РВЫХ ЗАД КРАС})
      x=setex({РРЕГ НАБОР2}[sys_num],{РВЫХ ЗАД КРАС})
      x=setex({РРЕГ НАБОР3}[sys_num],{РВЫХ ЗАД КРАС})
    endif
  else
    x=setex({ЗАД РРЕГ КРАС}[sys_num],{РВЫХ ЗАД КРАС})
    x=setex({РРЕГ НАБОР2}[sys_num],{РВЫХ ЗАД КРАС})
    x=setex({РРЕГ НАБОР3}[sys_num],{РВЫХ ЗАД КРАС})
  endif
endif

if(dout[1])
    dout[1]=ne(setwex({РЕЖ РЕГ04 КРАС}[sys_num],1,10),0)
endif




















