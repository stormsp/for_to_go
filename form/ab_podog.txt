; ГРС Красноусольский
; Галеев 07.2019
; Отсечка подогревателя

#include "eval.lib\set.evl"

;
func checkPrecond(dummy)
  x=0
  if (ne({РЕЖИМ ГРС КРАС},0))
    x=x|eq({ПГ ПРОР КРАС},1)
    x=x|eq({КОМ ОТКПГ КРАС},1)
  endif
  return(x)
endfunc

func oninit(t)
  dout[1]=0 ; команда 
 ; ждем первого опроса модулей
 sleep(10*18)                        
endfunc



if(checkPrecond(0))

  ; открыть кран на байпасе подогревателя
  x=setwex({КРАН БППГ КРАС}[sys_num],0,30)

  ; работаем дальше если кран открылся
  if(eq({КРАН БППГ КРАС},1)&dost({КР ПГВХ КРАС})&dost({КР ПГВЫХ КРАС}))

    ; входной кран подогревателя закрыть
    x=setwex({КР ПГВХ КРАС}[sys_num],1,30)

    ; выходной кран подогревателя закрыть
    x=setwex({КР ПГВЫХ КРАС}[sys_num],1,30)
; подогреватель отключить
   x=set_wait({ПГ УПР КРАС}[sys_num],2,20) 
  endif

  dout[1]=0 ; команда снята
endif

